@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@inject ProtectedLocalStorage ProtectedLocalStore
@inject FileSystemService FileSystemService

@using System.Net.Http
@using System.Net.Http.Json
@using System.Net.Http.Headers;
@inject HttpClient Http

@code {
    [Required]
    [Parameter] public string Path { get; set; } = string.Empty;

    private Folder? currentFolder { get; set; }
    private ContentModel content { get; set; } = new();

    private class ContentModel {
        public List<Folder> folders { get; set; } = new();
        public List<Document> documents { get; set; } = new();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await SetUp();
            StateHasChanged();
        }
    }

    private async Task SetUp() {
        Path = "/" + Path;
        var result = await ProtectedLocalStore.GetAsync<string>("token");
        var token = result.Success ? result.Value : null;

        if (!FileSystemService.IsInitialized()) {
            await FileSystemService.InitializeFileSystemAsync(token);
        }

        currentFolder = FileSystemService.GetFolder(Path);

        if (currentFolder == null) {
            Console.WriteLine("cant find this folder");
            return;
        }


        if (token != null) {
            var req = new HttpRequestMessage(HttpMethod.Get, $"Folder/content/{currentFolder.id}");
            req.Headers.Authorization = new AuthenticationHeaderValue("Bearer", token);
            var res = await Http.SendAsync(req);
            res.EnsureSuccessStatusCode();
            
            content = await res.Content.ReadFromJsonAsync<ContentModel>();
        }
    }
}

<div>
    <h3>@Path</h3>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">Type</th>
                <th scope="col">name</th>
                <th scope="col">Date</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var folder in content.folders) {
            <tr style="cursor: pointer;" onclick="location.href='@($"/Browse{@Path}/{@folder.name}")'">
                <td scope="row">üìÅ</td>
                <td>@folder.name</td>
                <td></td>
            </tr>
        }
        @foreach (var document in content.documents) {
            <tr>
                <td scope="row">üßæ</td>
                <td>@document.title</td>
                <td>@document.createdDate</td>
            </tr>
        }
        <tr>
            <td colspan="3" class="add-item-button"> 
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square-fill" viewBox="0 0 16 16">
                    <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                </svg> 
            </td>
        </tr>
        </tbody>

    </table>

    <style>
        .add-item-button {
            text-align: center;
            vertical-align: middle;
            cursor: pointer
        }
    </style>
</div>